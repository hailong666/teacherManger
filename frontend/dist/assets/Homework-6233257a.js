import{g as ke}from"./class-419f1a29.js";import{_ as Ve}from"./_plugin-vue_export-helper-c27b6911.js";import{r as d,v as z,c as he,o as xe,d as r,x as Ce,e as c,f as V,g as e,w as a,y,h as v,F as oe,z as se,i as u,A as ne,m as F,t as g,l as P,E as Se}from"./main-2e31a8b5.js";const De={class:"homework-container"},Ue={class:"create-homework-section"},Ie={class:"card-header"},He={class:"homework-list-section"},Ne={key:0},ze={style:{"white-space":"pre-wrap"}},Fe={key:0},Ae={style:{"margin-bottom":"20px"}},Ye={key:0},Be={key:1},Me={key:0},qe={class:"dialog-footer"},Le={__name:"Homework",setup(Re){d(!1);const A=d(!1),Y=d(!1),H=d(!1),B=d(!1),M=d(!1),q=d(),J=d(),D=d([]),L=d([]),_=d([]),m=d(null),h=d(null),R=d(!1),T=d(!1),U=d(!1),p=z({title:"",description:"",classId:"",dueDate:"",totalScore:100}),N=z({classId:"",status:""}),b=z({score:null,feedback:""}),f=z({page:1,limit:10,total:0}),re={title:[{required:!0,message:"请输入作业标题",trigger:"blur"}],description:[{required:!0,message:"请输入作业描述",trigger:"blur"}],classId:[{required:!0,message:"请选择班级",trigger:"change"}],dueDate:[{required:!0,message:"请选择截止时间",trigger:"change"}],totalScore:[{required:!0,message:"请输入总分",trigger:"blur"}]},ue={score:[{required:!0,message:"请输入得分",trigger:"blur"}]},K=he(()=>_.value.filter(s=>s.score!==null).length),de=async()=>{var s,l;Y.value=!0;try{const o=await ke();o&&o.classes?D.value=o.classes:D.value=[]}catch(o){y.error("获取班级列表失败："+(((l=(s=o.response)==null?void 0:s.data)==null?void 0:l.message)||o.message)),D.value=[]}finally{Y.value=!1}},ie=()=>{q.value.validate(async s=>{var l,o;if(s){A.value=!0;try{y.success("作业创建成功"),O(),k()}catch(n){y.error("创建作业失败："+(((o=(l=n.response)==null?void 0:l.data)==null?void 0:o.message)||n.message))}finally{A.value=!1}}})},O=()=>{q.value.resetFields()},k=async()=>{var s,l;H.value=!0;try{const o={homeworks:[{id:1,title:"数学作业1",description:"完成第一章练习题",className:"高一(1)班",classId:1,totalScore:100,submissionCount:25,dueDate:"2024-01-20 23:59:59",status:"active",createdAt:"2024-01-15 10:00:00"},{id:2,title:"语文作业1",description:"背诵古诗词",className:"高一(2)班",classId:2,totalScore:50,submissionCount:30,dueDate:"2024-01-18 23:59:59",status:"expired",createdAt:"2024-01-10 14:30:00"}],pagination:{total:2,page:1,limit:10}};L.value=o.homeworks,f.total=o.pagination.total}catch(o){y.error("获取作业列表失败："+(((l=(s=o.response)==null?void 0:s.data)==null?void 0:l.message)||o.message)),L.value=[],f.total=0}finally{H.value=!1}},me=s=>{m.value=s,R.value=!0},ce=async s=>{var l,o;m.value=s,T.value=!0,B.value=!0;try{const n=[{id:1,studentId:1,studentName:"张三",content:"这是我的作业内容...",submittedAt:"2024-01-19 15:30:00",score:85,feedback:"完成得不错"},{id:2,studentId:2,studentName:"李四",content:"这是我的作业内容...",submittedAt:"2024-01-19 20:15:00",score:null,feedback:null}];_.value=n}catch(n){y.error("获取提交情况失败："+(((o=(l=n.response)==null?void 0:l.data)==null?void 0:o.message)||n.message)),_.value=[]}finally{B.value=!1}},pe=s=>{h.value=s,b.score=s.score,b.feedback=s.feedback||"",U.value=!0},fe=()=>{J.value.validate(async s=>{var l,o;if(s){M.value=!0;try{y.success("评分成功");const n=_.value.findIndex(S=>S.id===h.value.id);n!==-1&&(_.value[n].score=b.score,_.value[n].feedback=b.feedback),U.value=!1}catch(n){y.error("评分失败："+(((o=(l=n.response)==null?void 0:l.data)==null?void 0:o.message)||n.message))}finally{M.value=!1}}})},ve=s=>{Se.confirm("确定要删除这个作业吗？删除后无法恢复！","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{var l,o;try{y.success("删除成功"),k()}catch(n){y.error("删除失败："+(((o=(l=n.response)==null?void 0:l.data)==null?void 0:o.message)||n.message))}}).catch(()=>{})},Q=s=>{switch(s){case"active":return"success";case"expired":return"warning";case"completed":return"info";default:return""}},W=s=>{switch(s){case"active":return"进行中";case"expired":return"已截止";case"completed":return"已完成";default:return"未知"}},ge=s=>{f.limit=s,f.page=1,k()},_e=s=>{f.page=s,k()};return xe(()=>{de(),k()}),(s,l)=>{const o=r("el-input"),n=r("el-form-item"),S=r("el-col"),x=r("el-option"),$=r("el-select"),X=r("el-row"),be=r("el-date-picker"),Z=r("el-input-number"),w=r("el-button"),ee=r("el-form"),le=r("el-card"),i=r("el-table-column"),E=r("el-tag"),te=r("el-table"),we=r("el-pagination"),C=r("el-descriptions-item"),ye=r("el-descriptions"),j=r("el-dialog"),G=r("el-statistic"),ae=Ce("loading");return c(),V("div",De,[e(le,{class:"homework-card"},{header:a(()=>[...l[17]||(l[17]=[v("div",{class:"card-header"},[v("h3",null,"创建作业")],-1)])]),default:a(()=>[v("div",Ue,[e(ee,{model:p,rules:re,ref_key:"createFormRef",ref:q,"label-width":"100px"},{default:a(()=>[e(X,{gutter:20},{default:a(()=>[e(S,{span:12},{default:a(()=>[e(n,{label:"作业标题",prop:"title"},{default:a(()=>[e(o,{modelValue:p.title,"onUpdate:modelValue":l[0]||(l[0]=t=>p.title=t),placeholder:"请输入作业标题"},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{span:12},{default:a(()=>[e(n,{label:"选择班级",prop:"classId"},{default:a(()=>[e($,{modelValue:p.classId,"onUpdate:modelValue":l[1]||(l[1]=t=>p.classId=t),placeholder:"请选择班级",style:{width:"100%"},loading:Y.value},{default:a(()=>[(c(!0),V(oe,null,se(D.value,t=>(c(),F(x,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),_:1}),e(n,{label:"作业描述",prop:"description"},{default:a(()=>[e(o,{modelValue:p.description,"onUpdate:modelValue":l[2]||(l[2]=t=>p.description=t),type:"textarea",rows:4,placeholder:"请输入作业描述"},null,8,["modelValue"])]),_:1}),e(X,{gutter:20},{default:a(()=>[e(S,{span:12},{default:a(()=>[e(n,{label:"截止时间",prop:"dueDate"},{default:a(()=>[e(be,{modelValue:p.dueDate,"onUpdate:modelValue":l[3]||(l[3]=t=>p.dueDate=t),type:"datetime",placeholder:"选择截止时间",style:{width:"100%"},format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{span:12},{default:a(()=>[e(n,{label:"总分",prop:"totalScore"},{default:a(()=>[e(Z,{modelValue:p.totalScore,"onUpdate:modelValue":l[4]||(l[4]=t=>p.totalScore=t),min:1,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(n,null,{default:a(()=>[e(w,{type:"primary",onClick:ie,loading:A.value},{default:a(()=>[...l[18]||(l[18]=[u("创建作业",-1)])]),_:1},8,["loading"]),e(w,{onClick:O},{default:a(()=>[...l[19]||(l[19]=[u("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1}),e(le,{class:"homework-card"},{header:a(()=>[v("div",Ie,[l[21]||(l[21]=v("h3",null,"作业列表",-1)),v("div",null,[e($,{modelValue:N.classId,"onUpdate:modelValue":l[5]||(l[5]=t=>N.classId=t),placeholder:"选择班级",onChange:k,style:{"margin-right":"10px"}},{default:a(()=>[e(x,{label:"全部班级",value:""}),(c(!0),V(oe,null,se(D.value,t=>(c(),F(x,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e($,{modelValue:N.status,"onUpdate:modelValue":l[6]||(l[6]=t=>N.status=t),placeholder:"作业状态",onChange:k,style:{"margin-right":"10px"}},{default:a(()=>[e(x,{label:"全部状态",value:""}),e(x,{label:"进行中",value:"active"}),e(x,{label:"已截止",value:"expired"}),e(x,{label:"已完成",value:"completed"})]),_:1},8,["modelValue"]),e(w,{onClick:k,loading:H.value},{default:a(()=>[...l[20]||(l[20]=[u("刷新",-1)])]),_:1},8,["loading"])])])]),default:a(()=>[v("div",He,[ne((c(),F(te,{data:L.value,style:{width:"100%"}},{default:a(()=>[e(i,{prop:"title",label:"作业标题","show-overflow-tooltip":""}),e(i,{prop:"className",label:"班级",width:"120"}),e(i,{prop:"totalScore",label:"总分",width:"80"}),e(i,{prop:"submissionCount",label:"提交数",width:"80"}),e(i,{prop:"dueDate",label:"截止时间",width:"180"}),e(i,{label:"状态",width:"100"},{default:a(t=>[e(E,{type:Q(t.row.status)},{default:a(()=>[u(g(W(t.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"createdAt",label:"创建时间",width:"180"}),e(i,{label:"操作",width:"200"},{default:a(t=>[e(w,{size:"small",onClick:I=>me(t.row)},{default:a(()=>[...l[22]||(l[22]=[u("查看",-1)])]),_:1},8,["onClick"]),e(w,{size:"small",onClick:I=>ce(t.row)},{default:a(()=>[...l[23]||(l[23]=[u("提交情况",-1)])]),_:1},8,["onClick"]),e(w,{size:"small",type:"danger",onClick:I=>ve(t.row)},{default:a(()=>[...l[24]||(l[24]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ae,H.value]]),e(we,{"current-page":f.page,"onUpdate:currentPage":l[7]||(l[7]=t=>f.page=t),"page-size":f.limit,"onUpdate:pageSize":l[8]||(l[8]=t=>f.limit=t),"page-sizes":[10,20,50,100],total:f.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ge,onCurrentChange:_e,style:{"margin-top":"20px","text-align":"right"}},null,8,["current-page","page-size","total"])])]),_:1}),e(j,{modelValue:R.value,"onUpdate:modelValue":l[9]||(l[9]=t=>R.value=t),title:"作业详情",width:"60%"},{default:a(()=>[m.value?(c(),V("div",Ne,[e(ye,{column:2,border:""},{default:a(()=>[e(C,{label:"作业标题"},{default:a(()=>[u(g(m.value.title),1)]),_:1}),e(C,{label:"班级"},{default:a(()=>[u(g(m.value.className),1)]),_:1}),e(C,{label:"总分"},{default:a(()=>[u(g(m.value.totalScore),1)]),_:1}),e(C,{label:"截止时间"},{default:a(()=>[u(g(m.value.dueDate),1)]),_:1}),e(C,{label:"状态"},{default:a(()=>[e(E,{type:Q(m.value.status)},{default:a(()=>[u(g(W(m.value.status)),1)]),_:1},8,["type"])]),_:1}),e(C,{label:"创建时间"},{default:a(()=>[u(g(m.value.createdAt),1)]),_:1}),e(C,{label:"作业描述",span:2},{default:a(()=>[v("div",ze,g(m.value.description),1)]),_:1})]),_:1})])):P("",!0)]),_:1},8,["modelValue"]),e(j,{modelValue:T.value,"onUpdate:modelValue":l[10]||(l[10]=t=>T.value=t),title:"提交情况",width:"80%"},{default:a(()=>[m.value?(c(),V("div",Fe,[v("div",Ae,[e(G,{title:"总提交数",value:_.value.length,suffix:"份",style:{display:"inline-block","margin-right":"40px"}},null,8,["value"]),e(G,{title:"已评分",value:K.value,suffix:"份",style:{display:"inline-block","margin-right":"40px"}},null,8,["value"]),e(G,{title:"待评分",value:_.value.length-K.value,suffix:"份",style:{display:"inline-block"}},null,8,["value"])]),ne((c(),F(te,{data:_.value,style:{width:"100%"}},{default:a(()=>[e(i,{prop:"studentName",label:"学生姓名",width:"120"}),e(i,{prop:"submittedAt",label:"提交时间",width:"180"}),e(i,{label:"状态",width:"100"},{default:a(t=>[e(E,{type:t.row.score!==null?"success":"warning"},{default:a(()=>[u(g(t.row.score!==null?"已评分":"待评分"),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"score",label:"得分",width:"80"},{default:a(t=>[t.row.score!==null?(c(),V("span",Ye,g(t.row.score),1)):(c(),V("span",Be,"-"))]),_:1}),e(i,{prop:"content",label:"作业内容","show-overflow-tooltip":""}),e(i,{label:"操作",width:"120"},{default:a(t=>[e(w,{size:"small",onClick:I=>pe(t.row)},{default:a(()=>[...l[25]||(l[25]=[u("评分",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ae,B.value]])])):P("",!0)]),_:1},8,["modelValue"]),e(j,{modelValue:U.value,"onUpdate:modelValue":l[16]||(l[16]=t=>U.value=t),title:"作业评分",width:"50%"},{footer:a(()=>[v("span",qe,[e(w,{onClick:l[15]||(l[15]=t=>U.value=!1)},{default:a(()=>[...l[26]||(l[26]=[u("取消",-1)])]),_:1}),e(w,{type:"primary",onClick:fe,loading:M.value},{default:a(()=>[...l[27]||(l[27]=[u("确定",-1)])]),_:1},8,["loading"])])]),default:a(()=>[h.value?(c(),V("div",Me,[e(ee,{model:b,rules:ue,ref_key:"gradeFormRef",ref:J,"label-width":"100px"},{default:a(()=>[e(n,{label:"学生姓名"},{default:a(()=>[e(o,{modelValue:h.value.studentName,"onUpdate:modelValue":l[11]||(l[11]=t=>h.value.studentName=t),disabled:""},null,8,["modelValue"])]),_:1}),e(n,{label:"作业内容"},{default:a(()=>[e(o,{modelValue:h.value.content,"onUpdate:modelValue":l[12]||(l[12]=t=>h.value.content=t),type:"textarea",rows:4,disabled:""},null,8,["modelValue"])]),_:1}),e(n,{label:"得分",prop:"score"},{default:a(()=>{var t;return[e(Z,{modelValue:b.score,"onUpdate:modelValue":l[13]||(l[13]=I=>b.score=I),min:0,max:((t=m.value)==null?void 0:t.totalScore)||100,style:{width:"100%"},placeholder:"请输入得分"},null,8,["modelValue","max"])]}),_:1}),e(n,{label:"评语",prop:"feedback"},{default:a(()=>[e(o,{modelValue:b.feedback,"onUpdate:modelValue":l[14]||(l[14]=t=>b.feedback=t),type:"textarea",rows:3,placeholder:"请输入评语"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):P("",!0)]),_:1},8,["modelValue"])])}}},je=Ve(Le,[["__scopeId","data-v-6fececf2"]]);export{je as default};
