import{r as v,v as F,o as ae,d as u,x as te,e as w,f as M,h as C,g as l,w as t,K as se,y as p,M as re,i,F as E,z as S,A as oe,m as k,t as z,l as ne,N as A,O as ue,E as I,P as ie}from"./main-34d96914.js";import{_ as de}from"./_plugin-vue_export-helper-c27b6911.js";const me={class:"user-management"},pe={class:"page-header"},ce={class:"pagination-container"},_e={class:"dialog-footer"},ge={__name:"UserManagement",setup(fe){const $=v(!1),B=v(!1),h=v([]),D=v([]),b=v(!1),y=v(!1),V=v(null),o=F({search:"",role:"",status:""}),m=F({page:1,limit:10,total:0}),s=F({id:null,username:"",real_name:"",email:"",role_id:null,password:"",status:"active"}),L={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],real_name:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],role_id:[{required:!0,message:"请选择角色",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度至少 6 个字符",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},c=async()=>{$.value=!0;try{const r={page:m.page,limit:m.limit,search:o.search,role:o.role,status:o.status},e=await se(r);h.value=e.users||[],m.total=e.total||0}catch(r){console.error("加载用户列表失败:",r),p.error("加载用户列表失败")}finally{$.value=!1}},P=async()=>{try{const r=await re();D.value=r.roles||[]}catch(r){console.error("加载角色列表失败:",r),p.error("加载角色列表失败")}},j=()=>{o.search="",o.role="",o.status="",m.page=1,c()},K=()=>{y.value=!1,Q(),b.value=!0},O=r=>{var e;y.value=!0,s.id=r.id,s.username=r.username,s.real_name=r.real_name,s.email=r.email,s.role_id=(e=r.role)==null?void 0:e.id,s.status=r.status,b.value=!0},G=async()=>{if(V.value)try{await V.value.validate(),B.value=!0,y.value?(await A(s.id,{real_name:s.real_name,email:s.email,role_id:s.role_id,status:s.status}),p.success("用户更新成功")):(await ue(s),p.success("用户创建成功")),b.value=!1,c()}catch(r){console.error("保存用户失败:",r),p.error("保存用户失败")}finally{B.value=!1}},H=async r=>{const e=r.status==="active"?"inactive":"active",n=e==="active"?"启用":"禁用";try{await I.confirm(`确定要${n}用户 "${r.real_name}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await A(r.id,{status:e}),p.success(`用户${n}成功`),c()}catch(_){_!=="cancel"&&(console.error(`${n}用户失败:`,_),p.error(`${n}用户失败`))}},J=async r=>{try{await I.confirm(`确定要删除用户 "${r.real_name}" 吗？此操作不可恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ie(r.id),p.success("用户删除成功"),c()}catch(e){e!=="cancel"&&(console.error("删除用户失败:",e),p.error("删除用户失败"))}},Q=()=>{s.id=null,s.username="",s.real_name="",s.email="",s.role_id=null,s.password="",s.status="active",V.value&&V.value.resetFields()},W=r=>({admin:"danger",teacher:"warning",student:"success"})[r]||"info",X=r=>r?new Date(r).toLocaleString("zh-CN"):"-";return ae(()=>{c(),P()}),(r,e)=>{const n=u("el-button"),_=u("el-input"),d=u("el-form-item"),g=u("el-option"),x=u("el-select"),T=u("el-form"),q=u("el-card"),f=u("el-table-column"),N=u("el-tag"),Y=u("el-table"),Z=u("el-pagination"),ee=u("el-dialog"),le=te("loading");return w(),M("div",me,[C("div",pe,[e[14]||(e[14]=C("h2",null,"用户管理",-1)),l(n,{type:"primary",onClick:K},{default:t(()=>[...e[13]||(e[13]=[i("新增用户",-1)])]),_:1})]),l(q,{class:"filter-card"},{default:t(()=>[l(T,{model:o,inline:""},{default:t(()=>[l(d,{label:"用户名"},{default:t(()=>[l(_,{modelValue:o.search,"onUpdate:modelValue":e[0]||(e[0]=a=>o.search=a),placeholder:"请输入用户名或姓名",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(d,{label:"角色"},{default:t(()=>[l(x,{modelValue:o.role,"onUpdate:modelValue":e[1]||(e[1]=a=>o.role=a),placeholder:"选择角色",clearable:"",style:{width:"150px"}},{default:t(()=>[l(g,{label:"全部",value:""}),(w(!0),M(E,null,S(D.value,a=>(w(),k(g,{key:a.id,label:a.name,value:a.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"状态"},{default:t(()=>[l(x,{modelValue:o.status,"onUpdate:modelValue":e[2]||(e[2]=a=>o.status=a),placeholder:"选择状态",clearable:"",style:{width:"120px"}},{default:t(()=>[l(g,{label:"全部",value:""}),l(g,{label:"激活",value:"active"}),l(g,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:t(()=>[l(n,{type:"primary",onClick:c},{default:t(()=>[...e[15]||(e[15]=[i("搜索",-1)])]),_:1}),l(n,{onClick:j},{default:t(()=>[...e[16]||(e[16]=[i("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(q,{class:"table-card"},{default:t(()=>[oe((w(),k(Y,{data:h.value,style:{width:"100%"}},{default:t(()=>[l(f,{prop:"id",label:"ID",width:"80"}),l(f,{prop:"username",label:"用户名",width:"120"}),l(f,{prop:"real_name",label:"真实姓名",width:"120"}),l(f,{prop:"email",label:"邮箱",width:"200"}),l(f,{label:"角色",width:"120"},{default:t(a=>{var U;return[l(N,{type:W((U=a.row.role)==null?void 0:U.name)},{default:t(()=>{var R;return[i(z(((R=a.row.role)==null?void 0:R.name)||"无角色"),1)]}),_:2},1032,["type"])]}),_:1}),l(f,{label:"状态",width:"100"},{default:t(a=>[l(N,{type:a.row.status==="active"?"success":"danger"},{default:t(()=>[i(z(a.row.status==="active"?"激活":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(f,{prop:"created_at",label:"创建时间",width:"180"},{default:t(a=>[i(z(X(a.row.created_at)),1)]),_:1}),l(f,{label:"操作",width:"200"},{default:t(a=>[l(n,{size:"small",onClick:U=>O(a.row)},{default:t(()=>[...e[17]||(e[17]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(n,{size:"small",type:a.row.status==="active"?"warning":"success",onClick:U=>H(a.row)},{default:t(()=>[i(z(a.row.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),l(n,{size:"small",type:"danger",onClick:U=>J(a.row)},{default:t(()=>[...e[18]||(e[18]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,$.value]]),C("div",ce,[l(Z,{"current-page":m.page,"onUpdate:currentPage":e[3]||(e[3]=a=>m.page=a),"page-size":m.limit,"onUpdate:pageSize":e[4]||(e[4]=a=>m.limit=a),"page-sizes":[10,20,50,100],total:m.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:c,onCurrentChange:c},null,8,["current-page","page-size","total"])])]),_:1}),l(ee,{modelValue:b.value,"onUpdate:modelValue":e[12]||(e[12]=a=>b.value=a),title:y.value?"编辑用户":"新增用户",width:"500px"},{footer:t(()=>[C("span",_e,[l(n,{onClick:e[11]||(e[11]=a=>b.value=!1)},{default:t(()=>[...e[19]||(e[19]=[i("取消",-1)])]),_:1}),l(n,{type:"primary",onClick:G,loading:B.value},{default:t(()=>[...e[20]||(e[20]=[i("保存",-1)])]),_:1},8,["loading"])])]),default:t(()=>[l(T,{model:s,rules:L,ref_key:"userFormRef",ref:V,"label-width":"80px"},{default:t(()=>[l(d,{label:"用户名",prop:"username"},{default:t(()=>[l(_,{modelValue:s.username,"onUpdate:modelValue":e[5]||(e[5]=a=>s.username=a),disabled:y.value},null,8,["modelValue","disabled"])]),_:1}),l(d,{label:"真实姓名",prop:"real_name"},{default:t(()=>[l(_,{modelValue:s.real_name,"onUpdate:modelValue":e[6]||(e[6]=a=>s.real_name=a)},null,8,["modelValue"])]),_:1}),l(d,{label:"邮箱",prop:"email"},{default:t(()=>[l(_,{modelValue:s.email,"onUpdate:modelValue":e[7]||(e[7]=a=>s.email=a)},null,8,["modelValue"])]),_:1}),l(d,{label:"角色",prop:"role_id"},{default:t(()=>[l(x,{modelValue:s.role_id,"onUpdate:modelValue":e[8]||(e[8]=a=>s.role_id=a),placeholder:"选择角色",style:{width:"100%"}},{default:t(()=>[(w(!0),M(E,null,S(D.value,a=>(w(),k(g,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),y.value?ne("",!0):(w(),k(d,{key:0,label:"密码",prop:"password"},{default:t(()=>[l(_,{modelValue:s.password,"onUpdate:modelValue":e[9]||(e[9]=a=>s.password=a),type:"password","show-password":""},null,8,["modelValue"])]),_:1})),l(d,{label:"状态",prop:"status"},{default:t(()=>[l(x,{modelValue:s.status,"onUpdate:modelValue":e[10]||(e[10]=a=>s.status=a),style:{width:"100%"}},{default:t(()=>[l(g,{label:"激活",value:"active"}),l(g,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},be=de(ge,[["__scopeId","data-v-ab41d34d"]]);export{be as default};
