import{a as P,r as b,v as x,o as F,d as i,x as Q,e as D,f as $,g as s,w as n,y as q,h as a,i as h,j as M,A as G,m as H,t as c,E as J}from"./main-34d96914.js";import{g as w,c as K}from"./attendance-fbbd8396.js";import{_ as O}from"./_plugin-vue_export-helper-c27b6911.js";const W={class:"student-attendance-container"},X={class:"card-header"},Z={class:"header-actions"},tt={class:"filter-section"},et={class:"attendance-list"},at={class:"pagination-wrapper"},st={class:"stats-content"},nt={class:"stat-item"},ot={class:"stat-number"},lt={class:"stat-item"},it={class:"stat-number"},rt={class:"stat-item"},dt={class:"stat-number"},ct={class:"stat-item"},ut={class:"stat-number"},pt={class:"stat-item"},_t={class:"stat-number"},mt={__name:"StudentAttendance",setup(vt){const V=P(),y=b(!1),v=b([]),u=b({});b(!1);const r=x({date:"",status:""}),o=x({page:1,limit:10,total:0}),g=async()=>{var e,t,_;y.value=!0;try{const p={page:o.page,limit:o.limit,date:r.date,status:r.status},d=await w(p);d&&d.attendances?(v.value=d.attendances||[],o.total=((e=d.pagination)==null?void 0:e.total)||0):(v.value=[],o.total=0)}catch(p){q.error("获取签到记录失败："+(((_=(t=p.response)==null?void 0:t.data)==null?void 0:_.message)||p.message)),v.value=[],o.total=0}finally{y.value=!1}},C=async()=>{try{const e=await K();e&&e.stats&&(u.value=e.stats[0]||{})}catch(e){console.error("获取签到统计失败:",e)}},z=()=>{g(),C()},T=e=>{o.limit=e,o.page=1,g()},Y=e=>{o.page=e,g()},k=e=>e?new Date(e).toLocaleString("zh-CN"):"-",A=e=>({present:"success",absent:"danger",late:"warning",leave:"info",location_invalid:"warning"})[e]||"info",B=e=>({present:"出勤",absent:"缺勤",late:"迟到",leave:"请假",location_invalid:"位置异常"})[e]||e,N=()=>{J.prompt("请输入签到会话ID或扫描二维码","扫码签到",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"请输入会话ID",inputValidator:e=>e?!0:"请输入会话ID"}).then(({value:e})=>{V.push(`/attendance/scan/${e}`)}).catch(()=>{})};return F(()=>{g(),C()}),(e,t)=>{const _=i("el-button"),p=i("el-date-picker"),d=i("el-form-item"),m=i("el-option"),E=i("el-select"),I=i("el-form"),f=i("el-table-column"),L=i("el-tag"),R=i("el-table"),U=i("el-pagination"),S=i("el-card"),j=Q("loading");return D(),$("div",W,[s(S,{class:"attendance-card"},{header:n(()=>[a("div",X,[t[6]||(t[6]=a("h3",null,"我的签到记录",-1)),a("div",Z,[s(_,{type:"primary",onClick:N},{default:n(()=>[...t[4]||(t[4]=[h("扫码签到",-1)])]),_:1}),s(_,{onClick:z},{default:n(()=>[...t[5]||(t[5]=[h("刷新",-1)])]),_:1})])])]),default:n(()=>[a("div",tt,[s(I,{model:r,inline:""},{default:n(()=>[s(d,{label:"日期"},{default:n(()=>[s(p,{modelValue:r.date,"onUpdate:modelValue":t[0]||(t[0]=l=>r.date=l),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:M(w)},null,8,["modelValue","onChange"])]),_:1}),s(d,{label:"状态"},{default:n(()=>[s(E,{modelValue:r.status,"onUpdate:modelValue":t[1]||(t[1]=l=>r.status=l),placeholder:"全部状态",clearable:"",onChange:M(w)},{default:n(()=>[s(m,{label:"出勤",value:"present"}),s(m,{label:"缺勤",value:"absent"}),s(m,{label:"迟到",value:"late"}),s(m,{label:"请假",value:"leave"}),s(m,{label:"位置异常",value:"location_invalid"})]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1},8,["model"])]),a("div",et,[G((D(),H(R,{data:v.value,style:{width:"100%"}},{default:n(()=>[s(f,{prop:"className",label:"班级",width:"120"}),s(f,{prop:"attendanceTime",label:"签到时间",width:"180"},{default:n(l=>[h(c(k(l.row.attendanceTime)),1)]),_:1}),s(f,{prop:"status",label:"状态",width:"100"},{default:n(l=>[s(L,{type:A(l.row.status)},{default:n(()=>[h(c(B(l.row.status)),1)]),_:2},1032,["type"])]),_:1}),s(f,{prop:"note",label:"备注","show-overflow-tooltip":""})]),_:1},8,["data"])),[[j,y.value]]),a("div",at,[s(U,{"current-page":o.page,"onUpdate:currentPage":t[2]||(t[2]=l=>o.page=l),"page-size":o.limit,"onUpdate:pageSize":t[3]||(t[3]=l=>o.limit=l),"page-sizes":[10,20,50,100],total:o.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:T,onCurrentChange:Y},null,8,["current-page","page-size","total"])])])]),_:1}),s(S,{class:"stats-card"},{header:n(()=>[...t[7]||(t[7]=[a("div",{class:"card-header"},[a("h3",null,"签到统计")],-1)])]),default:n(()=>[a("div",st,[a("div",nt,[a("div",ot,c(u.value.totalDays||0),1),t[8]||(t[8]=a("div",{class:"stat-label"},"总天数",-1))]),a("div",lt,[a("div",it,c(u.value.presentCount||0),1),t[9]||(t[9]=a("div",{class:"stat-label"},"出勤",-1))]),a("div",rt,[a("div",dt,c(u.value.lateCount||0),1),t[10]||(t[10]=a("div",{class:"stat-label"},"迟到",-1))]),a("div",ct,[a("div",ut,c(u.value.absentCount||0),1),t[11]||(t[11]=a("div",{class:"stat-label"},"缺勤",-1))]),a("div",pt,[a("div",_t,c(u.value.attendanceRate||0)+"%",1),t[12]||(t[12]=a("div",{class:"stat-label"},"出勤率",-1))])])]),_:1})])}}},ht=O(mt,[["__scopeId","data-v-e9c451ff"]]);export{ht as default};
