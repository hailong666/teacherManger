import{u as N,a as R,r as i,o as E,y as g,d as p,e as u,f as r,g as o,w as n,h as s,j as y,U as T,m as V,V as D,W as L,I as P,t as k,i as _,l as h,X as U}from"./main-2e31a8b5.js";import{s as z}from"./attendance-b297be21.js";import{_ as H}from"./_plugin-vue_export-helper-c27b6911.js";const Q={class:"attendance-scan-container"},W={class:"scan-content"},X={key:0,class:"loading-section"},j={key:1,class:"result-section"},q={class:"result-icon"},F={key:0,class:"attendance-info"},G={key:2,class:"scan-section"},J={class:"scan-info"},K={class:"location-section"},O={key:0,class:"location-tip"},Y={class:"action-buttons"},Z={__name:"AttendanceScan",setup($){const w=N(),b=R(),A=i(!1),x=i(!1),v=i(!1),a=i(null),m=i("");i(null),E(()=>{m.value=w.params.sessionId,m.value||(g.error("无效的签到链接"),b.push("/"))});const I=()=>new Promise((l,e)=>{if(!navigator.geolocation){e(new Error("浏览器不支持地理位置"));return}navigator.geolocation.getCurrentPosition(t=>{l({latitude:t.coords.latitude,longitude:t.coords.longitude})},t=>{e(t)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}),B=async()=>{var l,e,t,f;x.value=!0;try{let c=null;if(v.value)try{c=await I()}catch{g.warning("获取位置失败，将继续签到但不验证位置")}const d=await z({sessionId:m.value,location:c});a.value={success:!0,message:d.message||"签到成功",data:d},g.success(d.message||"签到成功")}catch(c){a.value={success:!1,message:((e=(l=c.response)==null?void 0:l.data)==null?void 0:e.message)||"签到失败",data:null},g.error(((f=(t=c.response)==null?void 0:t.data)==null?void 0:f.message)||"签到失败")}finally{x.value=!1}},S=l=>({present:"出勤",absent:"缺勤",late:"迟到",leave:"请假",location_invalid:"位置异常"})[l]||l,M=()=>{b.go(-1)};return(l,e)=>{const t=p("el-icon"),f=p("el-checkbox"),c=p("el-button"),d=p("el-card");return u(),r("div",Q,[o(d,{class:"scan-card"},{header:n(()=>[...e[1]||(e[1]=[s("div",{class:"card-header"},[s("h3",null,"学生签到")],-1)])]),default:n(()=>[s("div",W,[A.value?(u(),r("div",X,[o(t,{class:"is-loading"},{default:n(()=>[o(y(T))]),_:1}),e[2]||(e[2]=s("p",null,"正在处理签到...",-1))])):a.value?(u(),r("div",j,[s("div",q,[a.value.success?(u(),V(t,{key:0,class:"success-icon"},{default:n(()=>[o(y(D))]),_:1})):(u(),V(t,{key:1,class:"error-icon"},{default:n(()=>[o(y(L))]),_:1}))]),s("h4",{class:P(a.value.success?"success-text":"error-text")},k(a.value.message),3),a.value.success&&a.value.data?(u(),r("div",F,[s("p",null,[e[3]||(e[3]=s("strong",null,"签到时间：",-1)),_(k(a.value.data.attendanceTime),1)]),s("p",null,[e[4]||(e[4]=s("strong",null,"签到状态：",-1)),_(k(S(a.value.data.status)),1)])])):h("",!0)])):(u(),r("div",G,[s("div",J,[o(t,{class:"scan-icon"},{default:n(()=>[o(y(U))]),_:1}),e[5]||(e[5]=s("h4",null,"请确认签到信息",-1)),s("p",null,"会话ID: "+k(m.value),1)]),s("div",K,[o(f,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=C=>v.value=C)},{default:n(()=>[...e[6]||(e[6]=[_("启用位置验证",-1)])]),_:1},8,["modelValue"]),v.value?(u(),r("p",O," 启用位置验证后，系统将验证您的签到位置 ")):h("",!0)]),s("div",Y,[o(c,{type:"primary",onClick:B,loading:x.value},{default:n(()=>[...e[7]||(e[7]=[_(" 确认签到 ",-1)])]),_:1},8,["loading"]),o(c,{onClick:M},{default:n(()=>[...e[8]||(e[8]=[_("返回",-1)])]),_:1})])]))])]),_:1})])}}},ae=H(Z,[["__scopeId","data-v-1d8388b5"]]);export{ae as default};
